<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sparkle Tasks✨</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6fa8dc;
            --secondary-color: #9fc5e8;
            --accent-color: #b4a7d6;
            --light-color: #cfe2f3;
            --ultra-light-color: #e8f2ff;
            --text-color: #4a4a4a;
            --background-color: #f0f8ff;
            --card-color: #ffffff;
            --border-color: #d0e3fa;
            --delete-color: #ff9eaa;
            --complete-color: #a8d08d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            background-image: radial-gradient(var(--light-color) 10%, transparent 11%), 
                             radial-gradient(var(--light-color) 10%, transparent 11%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background-color: var(--card-color);
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(107, 167, 230, 0.2);
            border: 2px solid var(--light-color);
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.2em;
            letter-spacing: -0.5px;
        }

        h1 i {
            margin-right: 10px;
            color: var(--accent-color);
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info span {
            margin-right: 15px;
            font-weight: bold;
            color: var(--primary-color);
        }

        button {
            padding: 8px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            box-shadow: 0 3px 5px rgba(107, 167, 230, 0.2);
        }

        button:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .task-form {
            background-color: var(--card-color);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(107, 167, 230, 0.2);
            margin-bottom: 30px;
            border: 2px dashed var(--secondary-color);
        }

        .form-heading {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.5em;
        }

        .form-heading i {
            margin-right: 10px;
            color: var(--accent-color);
        }

        .form-row {
            display: flex;
            margin-bottom: 15px;
            gap: 15px;
        }

        .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 0.9em;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--light-color);
            border-radius: 15px;
            background-color: var(--ultra-light-color);
            transition: border-color 0.3s;
            font-size: 0.9em;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 8px rgba(180, 167, 214, 0.4);
        }

        .submit-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            font-weight: bold;
            font-size: 1em;
        }

        .filter-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background-color: var(--card-color);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(107, 167, 230, 0.1);
            border: 1px solid var(--light-color);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-label {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 0.9em;
        }

        .search-input {
            padding: 8px 15px;
            border-radius: 15px;
            border: 1px solid var(--light-color);
            background-color: var(--ultra-light-color);
        }

        .filter-select {
            padding: 8px 15px;
            border-radius: 15px;
            border: 1px solid var(--light-color);
            background-color: var(--ultra-light-color);
        }

        .tasks-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .task-card {
            background-color: var(--card-color);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(107, 167, 230, 0.15);
            padding: 20px;
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid var(--border-color);
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(107, 167, 230, 0.2);
        }

        .task-card.completed {
            border-color: var(--complete-color);
            background-color: #f0fff0;
        }

        .task-status {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.2em;
        }

        .task-category {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            background-color: var(--light-color);
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .task-title {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-weight: bold;
        }

        .task-description {
            font-size: 0.9em;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .task-due {
            font-size: 0.85em;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .edit-btn {
            background-color: var(--secondary-color);
        }

        .delete-btn {
            background-color: var(--delete-color);
        }

        .complete-btn {
            background-color: var(--complete-color);
        }

        .completed-label {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            background-color: var(--card-color);
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(107, 167, 230, 0.1);
        }

        .empty-state i {
            font-size: 3em;
            color: var(--light-color);
            margin-bottom: 20px;
        }

        .empty-state p {
            color: var(--primary-color);
            font-size: 1.2em;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--primary-color);
            font-size: 0.9em;
        }

        footer i {
            color: var(--accent-color);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-color);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            border: 2px solid var(--light-color);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--primary-color);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .task-card {
            animation: fadeIn 0.5s ease-out;
        }

        /* Cute decorations */
        .sparkle {
            position: relative;
        }

        .sparkle::after {
            content: "✨";
            position: absolute;
            top: -5px;
            right: -15px;
            font-size: 0.8em;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .filter-section {
                flex-direction: column;
                gap: 15px;
            }
            
            .tasks-container {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .user-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tasks"></i> Sparkle Tasks <span class="sparkle">✨</span></h1>
            <div class="user-info">
                <span id="username">Hi, User!</span>
                <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </header>

        <section class="task-form">
            <div class="form-heading">
                <i class="fas fa-magic"></i> Create a New Task
            </div>
            <form id="add-task-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-title">Task Title</label>
                        <input type="text" id="task-title" placeholder="What do you need to do?" required>
                    </div>
                    <div class="form-group">
                        <label for="task-category">Category</label>
                        <select id="task-category">
                            <option value="personal">Personal</option>
                            <option value="work">Work</option>
                            <option value="school">School</option>
                            <option value="health">Health</option>
                            <option value="shopping">Shopping</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-description">Description</label>
                        <textarea id="task-description" rows="3" placeholder="Add some details..."></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-due-date">Due Date</label>
                        <input type="date" id="task-due-date">
                    </div>
                    <div class="form-group">
                        <label for="task-priority">Priority</label>
                        <select id="task-priority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="submit-btn"><i class="fas fa-plus-circle"></i> Add Task</button>
            </form>
        </section>

        <section class="filter-section">
            <div class="filter-group">
                <span class="filter-label"><i class="fas fa-search"></i> Search:</span>
                <input type="text" id="search-input" class="search-input" placeholder="Search tasks...">
            </div>
            <div class="filter-group">
                <span class="filter-label"><i class="fas fa-filter"></i> Filter:</span>
                <select id="filter-status" class="filter-select">
                    <option value="all">All Tasks</option>
                    <option value="completed">Completed</option>
                    <option value="pending">Pending</option>
                </select>
                <select id="filter-category" class="filter-select">
                    <option value="all">All Categories</option>
                    <option value="personal">Personal</option>
                    <option value="work">Work</option>
                    <option value="school">School</option>
                    <option value="health">Health</option>
                    <option value="shopping">Shopping</option>
                    <option value="other">Other</option>
                </select>
            </div>
        </section>

        <div class="tasks-container" id="tasks-container">
            <!-- Tasks will be dynamically added here -->
            
            <!-- Empty state shown when no tasks exist -->
            <div class="empty-state" id="empty-state">
                <i class="fas fa-cloud"></i>
                <p>You don't have any tasks yet!</p>
                <p>Add your first task above to get started.</p>
            </div>
            
            <!-- Example task card (will be generated by JS) -->
            <!--
            <div class="task-card">
                <div class="task-status">
                    <i class="far fa-circle"></i>
                </div>
                <div class="task-category">Work</div>
                <h3 class="task-title">Complete project report</h3>
                <p class="task-description">Write the final report for the Q1 marketing campaign.</p>
                <div class="task-due">Due: Apr 15, 2025</div>
                <div class="task-actions">
                    <button class="edit-btn"><i class="fas fa-edit"></i> Edit</button>
                    <button class="delete-btn"><i class="fas fa-trash"></i> Delete</button>
                    <button class="complete-btn"><i class="fas fa-check"></i> Complete</button>
                </div>
            </div>
            -->
        </div>

        <!-- Edit Task Modal -->
        <div class="modal" id="edit-modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <div class="form-heading">
                    <i class="fas fa-edit"></i> Edit Task
                </div>
                <form id="edit-task-form">
                    <input type="hidden" id="edit-task-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-task-title">Task Title</label>
                            <input type="text" id="edit-task-title" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-task-category">Category</label>
                            <select id="edit-task-category">
                                <option value="personal">Personal</option>
                                <option value="work">Work</option>
                                <option value="school">School</option>
                                <option value="health">Health</option>
                                <option value="shopping">Shopping</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-task-description">Description</label>
                            <textarea id="edit-task-description" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-task-due-date">Due Date</label>
                            <input type="date" id="edit-task-due-date">
                        </div>
                        <div class="form-group">
                            <label for="edit-task-priority">Priority</label>
                            <select id="edit-task-priority">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="submit-btn"><i class="fas fa-save"></i> Save Changes</button>
                </form>
            </div>
        </div>

        <footer>
            <p>Made with <i class="fas fa-heart"></i> | Your Sparkle Tasks &copy; 2025</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const addTaskForm = document.getElementById('add-task-form');
            const editTaskForm = document.getElementById('edit-task-form');
            const tasksContainer = document.getElementById('tasks-container');
            const emptyState = document.getElementById('empty-state');
            const editModal = document.getElementById('edit-modal');
            const closeModal = document.querySelector('.close-modal');
            const searchInput = document.getElementById('search-input');
            const filterStatus = document.getElementById('filter-status');
            const filterCategory = document.getElementById('filter-category');
            const usernameElement = document.getElementById('username');
            const logoutBtn = document.getElementById('logout-btn');

            // Check if user is logged in
            const checkAuth = () => {
                const user = localStorage.getItem('currentUser');
                if (!user) {
                    window.location.href = 'login.html';
                    return false;
                }
                
                try {
                    const userData = JSON.parse(user);
                    usernameElement.textContent = `Hi, ${userData.username || 'User'}!`;
                    return true;
                } catch (e) {
                    console.error('Error parsing user data', e);
                    window.location.href = 'login.html';
                    return false;
                }
            };

            // Initialize tasks array
            let tasks = [];

            // Load tasks from localStorage
            const loadTasks = () => {
                const user = JSON.parse(localStorage.getItem('currentUser'));
                if (!user || !user.id) return;
                
                const savedTasks = localStorage.getItem(`tasks_${user.id}`);
                if (savedTasks) {
                    tasks = JSON.parse(savedTasks);
                    renderTasks();
                }
            };

            // Save tasks to localStorage
            const saveTasks = () => {
                const user = JSON.parse(localStorage.getItem('currentUser'));
                if (!user || !user.id) return;
                
                localStorage.setItem(`tasks_${user.id}`, JSON.stringify(tasks));
            };

            // Render tasks based on filters
            const renderTasks = () => {
                const statusFilter = filterStatus.value;
                const categoryFilter = filterCategory.value;
                const searchTerm = searchInput.value.toLowerCase().trim();
                
                // Filter tasks
                const filteredTasks = tasks.filter(task => {
                    // Status filter
                    if (statusFilter === 'completed' && !task.completed) return false;
                    if (statusFilter === 'pending' && task.completed) return false;
                    
                    // Category filter
                    if (categoryFilter !== 'all' && task.category !== categoryFilter) return false;
                    
                    // Search term
                    if (searchTerm && !task.title.toLowerCase().includes(searchTerm) && 
                        !task.description.toLowerCase().includes(searchTerm)) {
                        return false;
                    }
                    
                    return true;
                });
                
                // Clear current tasks
                while (tasksContainer.firstChild && tasksContainer.firstChild !== emptyState) {
                    tasksContainer.removeChild(tasksContainer.firstChild);
                }
                
                // Show/hide empty state
                if (filteredTasks.length === 0) {
                    emptyState.style.display = 'block';
                } else {
                    emptyState.style.display = 'none';
                    
                    // Render filtered tasks
                    filteredTasks.forEach(task => {
                        const taskCard = createTaskCard(task);
                        tasksContainer.appendChild(taskCard);
                    });
                }
            };

            // Create a task card
            const createTaskCard = (task) => {
                const taskCard = document.createElement('div');
                taskCard.className = `task-card ${task.completed ? 'completed' : ''}`;
                taskCard.dataset.id = task.id;
                
                // Format due date
                let formattedDate = '';
                if (task.dueDate) {
                    const date = new Date(task.dueDate);
                    formattedDate = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        year: 'numeric' 
                    });
                }
                
                // Priority icon
                let priorityIcon = '';
                if (task.priority === 'high') {
                    priorityIcon = '<i class="fas fa-exclamation-circle" style="color: #ff9eaa;"></i> ';
                } else if (task.priority === 'medium') {
                    priorityIcon = '<i class="fas fa-exclamation" style="color: #ffce56;"></i> ';
                }

                // Category icon
                let categoryIcon = '';
                switch(task.category) {
                    case 'personal': categoryIcon = '<i class="fas fa-user"></i> '; break;
                    case 'work': categoryIcon = '<i class="fas fa-briefcase"></i> '; break;
                    case 'school': categoryIcon = '<i class="fas fa-graduation-cap"></i> '; break;
                    case 'health': categoryIcon = '<i class="fas fa-heartbeat"></i> '; break;
                    case 'shopping': categoryIcon = '<i class="fas fa-shopping-cart"></i> '; break;
                    default: categoryIcon = '<i class="fas fa-tasks"></i> ';
                }
                
                taskCard.innerHTML = `
                    <div class="task-status">
                        ${task.completed ? 
                            '<i class="fas fa-check-circle" style="color: var(--complete-color);"></i>' : 
                            '<i class="far fa-circle"></i>'}
                    </div>
                    <div class="task-category">${categoryIcon}${task.category.charAt(0).toUpperCase() + task.category.slice(1)}</div>
                    <h3 class="task-title ${task.completed ? 'completed-label' : ''}">${priorityIcon}${task.title}</h3>
                    <p class="task-description ${task.completed ? 'completed-label' : ''}">${task.description}</p>
                    ${task.dueDate ? `<div class="task-due"><i class="far fa-calendar-alt"></i> Due: ${formattedDate}</div>` : ''}
                    <div class="task-actions">
                        <button class="edit-btn"><i class="fas fa-edit"></i> Edit</button>
                        <button class="delete-btn"><i class="fas fa-trash"></i> Delete</button>
                        <button class="complete-btn">
                            ${task.completed ? 
                                '<i class="fas fa-undo"></i> Undo' : 
                                '<i class="fas fa-check"></i> Complete'}
                        </button>
                    </div>
                `;
                
                // Add event listeners
                const editBtn = taskCard.querySelector('.edit-btn');
                const deleteBtn = taskCard.querySelector('.delete-btn');
                const completeBtn = taskCard.querySelector('.complete-btn');
                
                editBtn.addEventListener('click', () => {
                    openEditModal(task);
                });
                
                deleteBtn.addEventListener('click', () => {
                    deleteTask(task.id);
                });
                
                completeBtn.addEventListener('click', () => {
                    toggleTaskComplete(task.id);
                });
                
                return taskCard;
            };

            // Add a new task
            const addTask = (e) => {
                e.preventDefault();
                
                const title = document.getElementById('task-title').value.trim();
                const description = document.getElementById('task-description').value.trim();
                const category = document.getElementById('task-category').value;
                const dueDate = document.getElementById('task-due-date').value;
                const priority = document.getElementById('task-priority').value;
                
                if (!title) return;
                
                const newTask = {
                    id: Date.now().toString(),
                    title,
                    description,
                    category,
                    dueDate,
                    priority,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                tasks.unshift(newTask); // Add to the beginning
                saveTasks();
                renderTasks();
                
                // Reset form
                addTaskForm.reset();
            };

            // Delete a task
            const deleteTask = (taskId) => {
                if (confirm('Are you sure you want to delete this task?')) {
                    tasks = tasks.filter(task => task.id !== taskId);
                    saveTasks();
                    renderTasks();
                }
            };

            // Toggle task complete status
            const toggleTaskComplete = (taskId) => {
                const taskIndex = tasks.findIndex(task => task.id === taskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex].completed = !tasks[taskIndex].completed;
                    saveTasks();
                    renderTasks();
                }
            };

            // Open edit modal
            const openEditModal = (task) => {
                document.getElementById('edit-task-id').value = task.id;
                document.getElementById('edit-task-title').value = task.title;
                document.getElementById('edit-task-description').value = task.description;
                document.getElementById('edit-task-category').value = task.category;
                document.getElementById('edit-task-due-date').value = task.dueDate;
                document.getElementById('edit-task-priority').value = task.priority;
                
                editModal.style.display = 'flex';
            };

            // Close edit modal
            const closeEditModal = () => {
                editModal.style.display = 'none';
            };

            // Save edited task
            const saveEditedTask = (e) => {
                e.preventDefault();
                
                const taskId = document.getElementById('edit-task-id').value;
                const title = document.getElementById('edit-task-title').value.trim();
                const description = document.getElementById('edit-task-description').value.trim();
                const category = document.getElementById('edit-task-category').value;
                const dueDate = document.getElementById('edit-task-due-date').value;
                const priority = document.getElementById('edit-task-priority').value;
                
                if (!title) return;
                
                const taskIndex = tasks.findIndex(task => task.id === taskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        title,
                        description,
                        category,
                        dueDate,
                        priority
                    };
                    
                    saveTasks();
                    renderTasks();
                    closeEditModal();
                }
            };

            // Logout functionality
            const logout = () => {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            };

            // Event listeners
            addTaskForm.addEventListener('submit', addTask);
            editTaskForm.addEventListener('submit', saveEditedTask);
            closeModal.addEventListener('click', closeEditModal);
            window.addEventListener('click', (e) => {
                if (e.target === editModal) {
                    closeEditModal();
                }
            });
            
            searchInput.addEventListener('input', renderTasks);
            filterStatus.addEventListener('change', renderTasks);
            filterCategory.addEventListener('change', renderTasks);
            logoutBtn.addEventListener('click', logout);

            // Initialize
            if (checkAuth()) {
                loadTasks();
            }
        });
    </script>
</body>
</html>